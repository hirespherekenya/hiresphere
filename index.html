<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hiresphere | Elite Career Management</title>
    <meta name="description" content="Connecting top talent with verified opportunities. Your career growth, secured.">
    <meta name="theme-color" content="#0F172A">

    <!-- PWA Manifest & Meta -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Hiresphere">
    <link rel="apple-touch-icon" href="assets/images/logo.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/logo.png">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* DYNAMIC VARIABLES (Will be updated by JS) */
            --primary-dark: #0F172A; /* Fallback */
            --primary-blue: #334155;
            --accent-main: #2563EB;
            --accent-gradient: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%);
            
            --text-main: #1e293b;
            --text-muted: #64748b;
            
            --bg-body: #F8FAFC;
            --surface-white: #ffffff;
            
            /* UI Variables */
            --shadow-subtle: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-elevated: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
            
            --radius-lg: 24px;
            --radius-md: 16px;
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            
            --glass-bg: rgba(255, 255, 255, 0.9);
            --font-main: 'Plus Jakarta Sans', sans-serif;
        }

        * {margin:0;padding:0;box-sizing:border-box;}
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-main);
            color: var(--text-main);
            background: url('assets/images/background.png') repeat, var(--bg-body);
            background-size: 300px;
            overflow-x: hidden;
            padding-bottom: 100px;
            -webkit-font-smoothing: antialiased;
        }

        h1, h2, h3 { font-family: 'Playfair Display', serif; letter-spacing: -0.02em; }

        /* ---- ANIMATIONS ---- */
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s ease-out; }
        .reveal.active { opacity: 1; transform: translateY(0); }

        /* ---- HEADER ---- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 15px 5%; position: fixed; top: 0; left: 0; right: 0;
            z-index: 1000; box-shadow: var(--shadow-subtle); border-bottom: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.3s ease;
        }
        header.hidden { transform: translateY(-100%); }
        
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-container img { height: 45px; width: auto; object-fit: contain; }
        .logo-text { font-size: 1.4rem; font-weight: 700; color: var(--primary-dark); letter-spacing: -0.5px; font-family: 'Playfair Display', serif; }

        .header-actions .signin-btn {
            text-decoration: none; color: var(--primary-dark); font-weight: 600;
            padding: 10px 24px; background: rgba(0,0,0,0.03); border-radius: 50px;
            transition: var(--transition); font-size: 0.9rem; display: flex; align-items: center; gap: 8px;
        }
        .header-actions .signin-btn:hover { background: var(--primary-dark); color: #fff; transform: translateY(-2px); }

        /* ---- HERO SECTION ---- */
        .hero-section {
            position: relative; height: 95vh; min-height: 650px;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }
        .hero-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('assets/images/hero.png');
            background-size: cover; background-position: center;
            z-index: 0; filter: blur(8px); transform: scale(1.1); 
        }
        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(15, 23, 42, 0.6) 0%, rgba(15, 23, 42, 0.8) 100%);
            z-index: 1;
        }
        .hero-content { 
            position: relative; z-index: 2; text-align: center; 
            max-width: 850px; padding: 0 25px; color: #fff;
        }
        .hero-badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(8px);
            color: #fff; padding: 8px 20px; border-radius: 50px;
            font-weight: 500; font-size: 0.85rem; margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2); letter-spacing: 0.5px;
        }
        .hero-title { 
            font-size: clamp(2.8rem, 6vw, 5rem); font-weight: 700; line-height: 1.1; 
            margin-bottom: 25px; text-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        .hero-subtitle {
            color: #e2e8f0; font-size: clamp(1.1rem, 3vw, 1.35rem); line-height: 1.6; 
            margin-bottom: 45px; font-weight: 400; max-width: 700px; margin-left: auto; margin-right: auto;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .btn-primary {
            background: var(--surface-white); color: var(--primary-dark); 
            padding: 18px 45px; border-radius: 50px;
            font-size: 1.05rem; font-weight: 700; text-decoration: none; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            transition: var(--transition); border: none; cursor: pointer; display: inline-flex; align-items: center; gap: 12px;
        }
        .btn-primary:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 25px 50px rgba(0,0,0,0.3); }

        .btn-secondary {
            background: rgba(255,255,255,0.1); color: #fff;
            padding: 18px 35px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.3);
            font-size: 1.05rem; font-weight: 600; text-decoration: none;
            backdrop-filter: blur(5px); transition: var(--transition);
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); transform: translateY(-4px); }

        /* ---- SECTIONS ---- */
        .section { padding: 100px 20px; }
        .section-header { text-align: center; max-width: 700px; margin: 0 auto 60px; }
        .section-tag { color: var(--accent-main); font-weight: 700; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 2.5px; display: block; margin-bottom: 12px; }
        .section-title { font-size: 2.8rem; color: var(--primary-dark); font-weight: 700; }
        
        .steps-wrapper { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; max-width: 1200px; margin: 0 auto; }
        .step-box { 
            text-align: left; padding: 40px; background: var(--surface-white); 
            border-radius: var(--radius-lg); box-shadow: var(--shadow-subtle);
            border: 1px solid rgba(0,0,0,0.03); transition: var(--transition);
        }
        .step-box:hover { transform: translateY(-10px); box-shadow: var(--shadow-elevated); border-color: rgba(37, 99, 235, 0.1); }
        .step-icon { 
            width: 70px; height: 70px; background: #F1F5F9; 
            color: var(--primary-dark); border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; font-size: 1.7rem; margin-bottom: 25px;
            transition: var(--transition);
        }
        .step-box:hover .step-icon { background: var(--accent-main); color: #fff; }
        .step-title { font-weight: 700; font-size: 1.25rem; margin-bottom: 12px; color: var(--primary-dark); }
        .step-desc { font-size: 0.95rem; color: var(--text-muted); line-height: 1.6; }

        /* JOBS STYLES */
        .jobs-filter-bar {
            max-width: 1200px; margin: 0 auto 40px;
            background: #fff; border-radius: 16px; padding: 20px;
            box-shadow: var(--shadow-subtle); display: flex; gap: 15px; flex-wrap: wrap;
            align-items: center; border: 1px solid rgba(0,0,0,0.05);
        }
        .search-group { flex: 1; position: relative; min-width: 250px; }
        .search-group i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-input {
            width: 100%; padding: 12px 12px 12px 45px; border: 1px solid #e2e8f0; border-radius: 10px;
            font-family: inherit; font-size: 0.95rem; outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--accent-main); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
        .filter-select { padding: 12px 20px; border: 1px solid #e2e8f0; border-radius: 10px; background: #fff; color: var(--text-main); cursor: pointer; outline: none; min-width: 180px; }

        .jobs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 25px; max-width: 1200px; margin: 0 auto; }
        .job-card {
            background: #fff; border-radius: 20px; padding: 25px;
            box-shadow: var(--shadow-subtle); border: 1px solid rgba(0,0,0,0.04);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            display: flex; flex-direction: column; position: relative; overflow: hidden;
        }
        .job-card:hover { transform: translateY(-7px); box-shadow: var(--shadow-elevated); border-color: rgba(37, 99, 235, 0.2); }
        .job-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .company-logo-placeholder { width: 50px; height: 50px; background: #f1f5f9; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; color: var(--primary-dark); font-size: 1.2rem; }
        .job-time { font-size: 0.8rem; color: #94a3b8; background: #f8fafc; padding: 5px 10px; border-radius: 20px; }
        .job-title { font-size: 1.15rem; font-weight: 700; color: var(--primary-dark); margin-bottom: 5px; line-height: 1.3; }
        .company-name { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 15px; display: block; }
        .job-tags { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
        .job-tag { font-size: 0.75rem; padding: 4px 12px; border-radius: 6px; font-weight: 600; background: #eff6ff; color: var(--accent-main); }
        .job-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .apply-btn { background: var(--primary-dark); color: #fff; padding: 10px 20px; border-radius: 10px; font-size: 0.9rem; font-weight: 600; text-decoration: none; transition: 0.3s; border: none; cursor: pointer; }
        .apply-btn:hover { background: var(--accent-main); transform: translateY(-2px); }
        .loading-spinner { text-align: center; padding: 40px; color: var(--text-muted); }
        .no-jobs { text-align: center; grid-column: 1 / -1; padding: 40px; background: #fff; border-radius: 16px; color: var(--text-muted); }

        /* TESTIMONIALS */
        #testimonials-wrapper { display: none; } /* Hidden by default toggled via JS */
        .testimonial-section { padding: 40px 0 80px 0; overflow: hidden; background: linear-gradient(to bottom, transparent, #F8FAFC); }
        .testimonial-scroller { overflow: hidden; padding: 20px 0; white-space: nowrap; position: relative; mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); -webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); }
        .testimonial-track { display: inline-flex; gap: 25px; animation: scroll 40s linear infinite; }
        .testimonial-track:hover { animation-play-state: paused; }
        .testimonial-card { width: 320px; flex-shrink: 0; background: #fff; padding: 25px; border-radius: 16px; box-shadow: var(--shadow-subtle); border: 1px solid rgba(0,0,0,0.03); white-space: normal; }
        .t-user { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .t-user-avatar { width: 45px; height: 45px; border-radius: 50%; background: var(--primary-blue); color: #fff; display: grid; place-items: center; font-weight: 700; font-size: 0.9rem; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(calc(-100% / 2)); } }

        /* STATS */
        #statsSection { display: none; background: #fff; padding: 80px 20px; border-top: 1px solid #f1f5f9; }
        .stats-grid { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; text-align: center; }
        .stat-item h3 { font-family: 'Playfair Display', serif; font-size: 3.5rem; color: var(--accent-main); font-weight: 700; margin-bottom: 10px; line-height: 1; display: flex; align-items: center; justify-content: center; }
        .stat-plus { font-size: 2rem; vertical-align: super; margin-left: 2px; opacity: 0.8; }
        .stat-item p { color: var(--text-muted); font-size: 0.85rem; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; }

        /* FOOTER */
        .main-footer { background: var(--primary-dark); color: #fff; padding: 80px 20px 140px 20px; position: relative; overflow: hidden; }
        .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; position: relative; z-index: 2; }
        .footer-logo { font-size: 2rem; font-family: 'Playfair Display', serif; font-weight: 700; margin-bottom: 20px; display: inline-block; }
        .footer-text { color: #94a3b8; max-width: 500px; margin: 0 auto 40px; line-height: 1.6; }
        .social-icons { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; }
        .social-btn { width: 45px; height: 45px; border-radius: 50%; background: rgba(255, 255, 255, 0.05); color: #fff; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: var(--transition); border: 1px solid rgba(255, 255, 255, 0.1); text-decoration: none; }
        .social-btn:hover { background: var(--accent-main); transform: translateY(-5px); }
        .footer-links { margin: 30px 0; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .footer-links a { color: #cbd5e1; text-decoration: none; font-size: 0.95rem; font-weight: 500; transition: 0.3s; opacity: 0.8; }
        .footer-links a:hover { color: #fff; opacity: 1; }
        .footer-copy { border-top: 1px solid rgba(255,255,255,0.1); padding-top: 30px; color: #64748b; font-size: 0.85rem; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px; max-width: 800px; margin: 0 auto; }
        .footer-copy a { color: #64748b; text-decoration: none; transition: 0.3s; }
        .footer-copy a:hover { color: #fff; }

        .scroll-top-btn { position: fixed; bottom: 100px; right: 20px; width: 50px; height: 50px; background: var(--glass-bg); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.5); color: var(--primary-dark); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.1); opacity: 0; pointer-events: none; transform: translateY(20px); transition: var(--transition); z-index: 999; }
        .scroll-top-btn.visible { opacity: 1; pointer-events: all; transform: translateY(0); }
        
        @media (max-width: 768px) {
            .hero-title { font-size: 2.8rem; }
            .header-actions .signin-btn span { display: none; }
            .header-actions .signin-btn { padding: 10px; width: 44px; height: 44px; justify-content: center; }
            .hero-cta-group { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 300px; margin: 0 auto; }
            .btn-primary, .btn-secondary { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body id="top">

<!-- HEADER -->
<header id="header">
   <a href="index.html" class="logo-container">
       <img src="assets/images/logo.png" alt="Logo" id="headerLogo">
       <span class="logo-text" id="headerAppName">HireSphere</span>
   </a>
   
   <div class="header-actions">
       <a href="signin.html" class="signin-btn">
           <i class="fas fa-user-circle"></i>
           <span>Member Login</span>
       </a>
   </div>
</header>

<!-- HERO SECTION -->
<section class="hero-section">
    <div class="hero-bg"></div>
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <div class="hero-badge reveal active">
            <i class="fas fa-shield-alt"></i> <span id="heroBadge">Official Recruitment Partner</span>
        </div>
        <h1 class="hero-title reveal active" id="heroTitle">
            Elite Careers.<br>Verified Opportunities.
        </h1>
        <p class="hero-subtitle reveal active" id="heroSubtitle">
            We bridge the gap between ambition and achievement. Access secured, high-paying roles through our exclusive membership network.
        </p>
        <div class="hero-cta-group reveal active">
            <a href="signup.html" class="btn-primary">
                Join Network <i class="fas fa-arrow-right"></i>
            </a>
            <a href="contact.html" class="btn-secondary" id="contactBtn">
                Contact Support
            </a>
        </div>
    </div>
</section>

<!-- BENEFITS -->
<section class="section">
    <div class="section-header reveal">
        <span class="section-tag">Excellence in Hiring</span>
        <h2 class="section-title">The <span class="brand-name-span">Hiresphere</span> Advantage</h2>
    </div>
    <div class="steps-wrapper reveal">
        <div class="step-box">
            <div class="step-icon"><i class="fas fa-check-double"></i></div>
            <div class="step-title">Guaranteed Placement</div>
            <div class="step-desc">Our premium tiers offer assured placement with verified companies. We prioritize your success above all else.</div>
        </div>
        <div class="step-box">
            <div class="step-icon"><i class="fas fa-brain"></i></div>
            <div class="step-title">AI-Driven Matching</div>
            <div class="step-desc">Proprietary algorithms analyze your profile against thousands of openings to find your perfect professional fit instantly.</div>
        </div>
        <div class="step-box">
            <div class="step-icon"><i class="fas fa-rocket"></i></div>
            <div class="step-title">Accelerated Growth</div>
            <div class="step-desc">Unlock higher salary bands and leadership roles. Members receive complimentary CV optimization and coaching.</div>
        </div>
    </div>
</section>

<!-- RECENT JOBS -->
<section class="section" id="recent-jobs" style="background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.03));">
    <div class="section-header reveal">
        <span class="section-tag">Latest Opportunities</span>
        <h2 class="section-title">Recently Added Jobs</h2>
        <p style="color:var(--text-muted); margin-top:10px;">Explore high-growth roles curated for our network members.</p>
    </div>

    <!-- Filter -->
    <div class="jobs-filter-bar reveal">
        <div class="search-group">
            <i class="fas fa-search"></i>
            <input type="text" id="jobSearch" class="search-input" placeholder="Search by title or company...">
        </div>
        <select id="categoryFilter" class="filter-select">
            <option value="all">All Categories</option>
            <option value="Information Technology">Information Technology</option>
            <option value="Finance">Finance & Banking</option>
            <option value="Healthcare">Healthcare</option>
            <option value="Engineering">Engineering</option>
            <option value="Marketing">Marketing</option>
        </select>
    </div>

    <!-- Grid -->
    <div id="jobs-container" class="jobs-grid reveal active">
        <div class="loading-spinner"><i class="fas fa-circle-notch fa-spin fa-2x"></i></div>
    </div>
    
    <div style="text-align:center; margin-top:50px;">
        <a href="jobs.html" class="btn-secondary" style="color: var(--primary-dark); border-color: var(--primary-dark);">View All Openings</a>
    </div>
</section>

<!-- TESTIMONIALS (Toggleable) -->
<div id="testimonials-wrapper" class="reveal">
    <div class="testimonial-section">
        <div class="testimonial-scroller" id="testimonialScroller">
            <div class="loading-spinner" style="padding: 10px;">Loading success stories...</div>
        </div>
    </div>
</div>

<!-- STATS (Toggleable) -->
<section class="stats-section reveal" id="statsSection">
    <div class="stats-grid" id="statsGrid">
        <!-- Injected via JS -->
    </div>
</section>

<!-- FOOTER -->
<footer class="main-footer">
    <div class="footer-content">
        <div class="footer-logo" id="footerLogo">HireSphere</div>
        <p class="footer-text">
            We are a premium career management agency. We do not sell jobs; fees cover membership, verification services, and exclusive platform access.
        </p>

        <!-- Social Icons -->
        <div class="social-icons" id="footerSocials">
            <!-- Dynamic -->
        </div>

        <div class="footer-links">
            <a href="index.html">Home</a>
            <a href="jobs.html">Jobs Portal</a>
            <a href="dashboard.html">Member Dashboard</a>
            <a href="contact.html">Contact Us</a>
            <a href="privacy.html">Privacy Policy</a>
        </div>

        <div class="footer-copy">
            <span>&copy; <span id="copyrightYear">2026</span> <span id="copyrightName">Hiresphere Agency</span>. All Rights Reserved.</span>
            <span>
                <a href="terms.html">Terms of Service</a> &bull; 
                <a href="privacy.html">Privacy Policy</a>
            </span>
        </div>
    </div>
</footer>

<!-- SCROLL TOP -->
<a href="#top" class="scroll-top-btn" id="scrollTopBtn"><i class="fas fa-chevron-up"></i></a>

<!-- PWA POPUP -->
<div id="pwa-install-popup" style="display: none; position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: #fff; border: 1px solid rgba(0,0,0,0.1); border-radius: 20px; padding: 20px; z-index: 3000; box-shadow: 0 20px 60px rgba(0,0,0,0.2); animation: slideUpPwa 0.5s ease-out;">
    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
        <div style="width: 50px; height: 50px; border-radius: 12px; background: var(--primary-dark); display: grid; place-items: center; font-size: 1.5rem; color: #fff; box-shadow: 0 5px 15px rgba(15, 23, 42, 0.3);">
            <i class="fas fa-download"></i>
        </div>
        <div>
            <div style="font-weight:700; color:var(--primary-dark); font-size:1rem;">Install App</div>
            <div style="font-size:0.85rem; color:#64748b;">Add to home screen for fast access.</div>
        </div>
    </div>
    <div style="display: flex; gap: 10px;">
        <button id="pwaInstallBtn" style="flex: 2; padding: 12px; background: var(--primary-dark); border: none; border-radius: 10px; font-weight: 700; cursor: pointer; color: #fff; transition:0.3s;">Install</button>
        <button id="pwaDismissBtn" style="flex: 1; padding: 12px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 10px; color: var(--text-muted); cursor: pointer; font-weight: 600; transition:0.3s;">Later</button>
    </div>
</div>
<style>@keyframes slideUpPwa { from { transform: translateX(-50%) translateY(50px); opacity: 0; } to { transform: translateX(-50%) translateY(0); opacity: 1; } }</style>

<!-- LOGIC -->
<script type="module">
    import { auth, db } from './config.js'; 
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js';
    import { collection, query, orderBy, limit, getDocs, getDoc, doc } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js';

    let currentUser = null;
    let allJobs = [];
    
    // Config Elements
    const headerAppName = document.getElementById('headerAppName');
    const footerLogo = document.getElementById('footerLogo');
    const footerSocials = document.getElementById('footerSocials');
    const copyrightName = document.getElementById('copyrightName');
    const brandSpans = document.querySelectorAll('.brand-name-span');
    const heroTitle = document.getElementById('heroTitle');
    const heroSubtitle = document.getElementById('heroSubtitle');
    const statsSection = document.getElementById('statsSection');
    const statsGrid = document.getElementById('statsGrid');
    const testimonialsWrapper = document.getElementById('testimonials-wrapper');
    const contactBtn = document.getElementById('contactBtn');

    // 1. CONFIG LOADER
    async function loadAppConfig() {
        try {
            // BRANDING
            const brandSnap = await getDoc(doc(db, "settings", "branding"));
            if (brandSnap.exists()) {
                const data = brandSnap.data();
                const appName = data.appName || 'HireSphere';
                
                document.title = `${appName} | Elite Career Management`;
                headerAppName.textContent = appName;
                footerLogo.textContent = appName;
                copyrightName.textContent = appName;
                brandSpans.forEach(el => el.textContent = appName);

                if(data.primaryColor) {
                    document.documentElement.style.setProperty('--primary-dark', data.primaryColor);
                }
                if(data.fontFamily) {
                    document.documentElement.style.setProperty('--font-main', `${data.fontFamily}, sans-serif`);
                }
            }

            // LANDING PAGE CONFIG
            const landSnap = await getDoc(doc(db, "settings", "landing_page"));
            if (landSnap.exists()) {
                const data = landSnap.data();
                
                // Hero Texts
                if(data.heroTitle) heroTitle.innerHTML = data.heroTitle.replace(/\n/g, '<br>');
                if(data.heroSubtitle) heroSubtitle.textContent = data.heroSubtitle;

                // Testimonials Toggle
                if(data.enableTestimonials) {
                    testimonialsWrapper.style.display = 'block';
                    fetchTestimonials(data.testimonialsLimit || 8);
                }

                // Stats Toggle & Data
                if(data.enableStats) {
                    statsSection.style.display = 'block';
                    let statsHTML = '';
                    const stats = data.stats || [
                        { label: 'Careers Launched', value: 5000, suffix: 'k+' },
                        { label: 'Verification Rate', value: 98, suffix: '%' },
                        { label: 'Partner Companies', value: 450, suffix: '+' }
                    ];
                    
                    stats.forEach(s => {
                        statsHTML += `
                        <div class="stat-item">
                            <h3><span class="counter" data-target="${s.value}">0</span><span class="stat-plus">${s.suffix}</span></h3>
                            <p>${s.label}</p>
                        </div>`;
                    });
                    statsGrid.innerHTML = statsHTML;
                    initStatsObserver(); 
                }
            }

            // GENERAL (Socials + Contact)
            const genSnap = await getDoc(doc(db, "settings", "general"));
            if(genSnap.exists()) {
                const data = genSnap.data();
                if(data.socialLinks) {
                    try {
                        const socials = JSON.parse(data.socialLinks);
                        let html = '';
                        socials.forEach(s => {
                            let icon = 'fas fa-link';
                            if(s.platform.toLowerCase().includes('what')) icon = 'fab fa-whatsapp';
                            if(s.platform.toLowerCase().includes('tik')) icon = 'fab fa-tiktok';
                            if(s.platform.toLowerCase().includes('face')) icon = 'fab fa-facebook';
                            if(s.platform.toLowerCase().includes('mail')) icon = 'fas fa-envelope';
                            html += `<a href="${s.url}" class="social-btn" target="_blank"><i class="${icon}"></i></a>`;
                        });
                        footerSocials.innerHTML = html;
                    } catch(e) {}
                }

                if(data.whatsappPhone) {
                    contactBtn.href = `https://wa.me/${data.whatsappPhone}`;
                    contactBtn.target = "_blank";
                } else if (data.supportEmail) {
                    contactBtn.href = `mailto:${data.supportEmail}`;
                }
            }

        } catch (e) { console.error("Config Load Error", e); }
    }

    // 2. Auth Listener
    onAuthStateChanged(auth, (user) => {
        currentUser = user;
        const signinBtn = document.querySelector('.signin-btn');
        if (signinBtn) {
            if (user) {
                signinBtn.href = "dashboard.html";
                signinBtn.innerHTML = '<i class="fas fa-user-check"></i><span>Dashboard</span>';
            } else {
                signinBtn.href = "signin.html";
                signinBtn.innerHTML = '<i class="fas fa-user-circle"></i><span>Member Login</span>';
            }
        }
    });

    // 3. Fetch Jobs
    async function fetchRecentJobs() {
        const jobsContainer = document.getElementById('jobs-container');
        try {
            const q = query(collection(db, "jobs"), orderBy("createdAt", "desc"), limit(6));
            const querySnapshot = await getDocs(q);
            
            allJobs = [];
            querySnapshot.forEach((doc) => {
                allJobs.push({ id: doc.id, ...doc.data() });
            });

            renderJobs(allJobs);

        } catch (error) {
            console.error("Error fetching jobs: ", error);
            jobsContainer.innerHTML = `<div class="no-jobs"><i class="fas fa-exclamation-circle"></i> Unable to load jobs.</div>`;
        }
    }

    function renderJobs(jobsToRender) {
        const jobsContainer = document.getElementById('jobs-container');
        if (jobsToRender.length === 0) {
            jobsContainer.innerHTML = `<div class="no-jobs">No jobs found matching your criteria.</div>`;
            return;
        }

        jobsContainer.innerHTML = jobsToRender.map(job => {
            const postDate = job.createdAt ? new Date(job.createdAt.seconds*1000) : new Date();
            const timeAgo = getTimeAgo(postDate);
            const companyInitial = job.company ? job.company.charAt(0).toUpperCase() : 'H';
            const category = job.category || 'General';

            return `
                <div class="job-card" data-category="${category}">
                    <div class="job-header">
                        <div class="company-logo-placeholder">${companyInitial}</div>
                        <span class="job-time">${timeAgo}</span>
                    </div>
                    <h3 class="job-title">${job.title || 'Untitled Role'}</h3>
                    <span class="company-name">${job.company || 'Confidential Client'}</span>
                    
                    <div class="job-tags">
                        <span class="job-tag">${category}</span>
                        ${job.city ? `<span class="job-tag" style="background:#f1f5f9;color:#64748b;">${job.city}</span>` : ''}
                    </div>
                    
                    <div class="job-footer">
                        <span style="font-size:0.85rem; color:#64748b; font-weight:500;">
                            <i class="fas fa-users"></i> ${Math.floor(Math.random() * 20) + 5} applied
                        </span>
                        <button class="apply-btn" onclick="handleApply('${job.id}')">
                            Apply Now
                        </button>
                    </div>
                </div>
            `;
        }).join('');
    }

    function getTimeAgo(date) {
        const seconds = Math.floor((new Date() - date) / 1000);
        let interval = seconds / 31536000;
        if (interval > 1) return Math.floor(interval) + "y ago";
        interval = seconds / 2592000;
        if (interval > 1) return Math.floor(interval) + "mo ago";
        interval = seconds / 86400;
        if (interval > 1) return Math.floor(interval) + "d ago";
        return "Just now";
    }

    window.handleApply = (jobId) => {
        if (currentUser) {
            window.location.href = `job-details.html?id=${jobId}`;
        } else {
            sessionStorage.setItem('redirectAfterLogin', `job-details.html?id=${jobId}`);
            window.location.href = "signin.html";
        }
    };

    // 4. Fetch Testimonials
    async function fetchTestimonials(limitCount) {
        const scroller = document.getElementById('testimonialScroller');
        try {
            const q = query(collection(db, "testimonials"), orderBy("createdAt", "desc"), limit(limitCount));
            const querySnapshot = await getDocs(q);
            
            let htmlContent = '';
            
            if(querySnapshot.empty) {
                scroller.innerHTML = `<div style="text-align:center;width:100%;color:#64748b;">Success stories coming soon.</div>`;
                return;
            }

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const initial = data.name ? data.name.charAt(0).toUpperCase() : 'U';
                const colors = ['#2563EB', '#F59E0B', '#10B981', '#7C3AED'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                htmlContent += `
                    <div class="testimonial-card">
                        <div class="t-user">
                            <div class="t-user-avatar" style="background:${color}">${initial}</div>
                            <div class="t-user-info">
                                <strong>${data.name || 'Member'}</strong>
                                <span>${data.role || 'User'}</span>
                            </div>
                        </div>
                        <p style="font-size:0.9rem;color:#64748b;line-height:1.5;">"${data.text || data.testimony}"</p>
                    </div>
                `;
            });

            scroller.innerHTML = `<div class="testimonial-track">${htmlContent}${htmlContent}</div>`;

        } catch (error) { console.error("Testimonial Error:", error); }
    }

    // 5. Init
    document.addEventListener('DOMContentLoaded', () => {
        loadAppConfig();
        fetchRecentJobs();
        document.getElementById('copyrightYear').textContent = new Date().getFullYear();

        const searchInput = document.getElementById('jobSearch');
        const categorySelect = document.getElementById('categoryFilter');

        function filterJobs() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categorySelect.value;

            const filtered = allJobs.filter(job => {
                const matchesSearch = (job.title && job.title.toLowerCase().includes(searchTerm)) || 
                                      (job.company && job.company.toLowerCase().includes(searchTerm));
                const matchesCategory = selectedCategory === 'all' || job.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });
            renderJobs(filtered);
        }

        searchInput.addEventListener('input', filterJobs);
        categorySelect.addEventListener('change', filterJobs);
    });

    // 6. Stats Animation
    function initStatsObserver() {
        const counters = document.querySelectorAll('.counter');
        let animated = false;

        const statsObserver = new IntersectionObserver((entries) => {
            const [entry] = entries;
            if (entry.isIntersecting && !animated) {
                counters.forEach(counter => {
                    const target = +counter.getAttribute('data-target');
                    const duration = 2000; 
                    const increment = target / (duration / 20); 
                    
                    let current = 0;
                    const updateCounter = () => {
                        current += increment;
                        if (current < target) {
                            counter.innerText = Math.ceil(current);
                            setTimeout(updateCounter, 20);
                        } else {
                            if(target === 5000) counter.innerText = "5"; 
                            else counter.innerText = target;
                        }
                    };
                    updateCounter();
                });
                animated = true;
            }
        }, { threshold: 0.5 });

        if (statsSection) statsObserver.observe(statsSection);
    }
</script>

<script>
    // Header Scroll & Reveal
    document.addEventListener('DOMContentLoaded', () => {
        const header = document.getElementById('header');
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        let lastScroll = 0;

        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;
            if (currentScroll <= 0) header.classList.remove('hidden');
            else {
                if (currentScroll > lastScroll && currentScroll > 100) header.classList.add('hidden');
                else header.classList.remove('hidden');
            }

            if (currentScroll > 300) scrollTopBtn.classList.add('visible');
            else scrollTopBtn.classList.remove('visible');

            lastScroll = currentScroll;
        });

        scrollTopBtn.addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) entry.target.classList.add('active');
            });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
    });

    // PWA Logic
    let deferredPrompt;
    const pwaPopup = document.getElementById('pwa-install-popup');
    const pwaInstallBtn = document.getElementById('pwaInstallBtn');
    const pwaDismissBtn = document.getElementById('pwaDismissBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent the mini-infobar from appearing on mobile
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        // Show the install prompt after a short delay (e.g., 3 seconds)
        setTimeout(() => {
            pwaPopup.style.display = 'block';
        }, 3000);
    });

    pwaInstallBtn.addEventListener('click', async () => {
        if (deferredPrompt) {
            // Show the install prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);
            
            // We've used the prompt, and can't use it again, throw it away
            deferredPrompt = null;
            // Hide the custom popup
            pwaPopup.style.display = 'none';
        }
    });

    pwaDismissBtn.addEventListener('click', () => {
        pwaPopup.style.display = 'none';
    });

    // Register Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./service-worker.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }
</script>

</body>
</html>
