<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Contact Support | HireSphere</title>
    <meta name="description" content="Get in touch with our support team for assistance with your membership or applications.">
    <meta name="theme-color" content="#0F172A">

    <!-- PWA Manifest & Meta -->
    <link rel="manifest" href="./manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="assets/images/icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/icon-192.png">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* DYNAMIC VARIABLES */
            --primary-dark: #0F172A;
            --primary-blue: #334155;
            --accent-main: #2563EB;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --bg-body: #F8FAFC;
            --surface-white: #ffffff;
            
            --shadow-subtle: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-elevated: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
            --radius-lg: 24px;
            --glass-bg: rgba(255, 255, 255, 0.9);
            --transition: all 0.3s ease;
            --success-green: #10b981;
            
            --font-main: 'Plus Jakarta Sans', sans-serif;
        }

        * {margin:0;padding:0;box-sizing:border-box;}
        html { scroll-behavior: smooth; }

        body {
            font-family: var(--font-main);
            color: var(--text-main);
            background: url('assets/images/background.png') repeat, var(--bg-body);
            background-size: 300px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* ---- HEADER ---- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--glass-bg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            padding: 15px 5%; position: fixed; top: 0; left: 0; right: 0;
            z-index: 1000; box-shadow: var(--shadow-subtle); border-bottom: 1px solid rgba(0,0,0,0.03);
            transition: transform 0.3s ease;
        }
        header.hidden { transform: translateY(-100%); }
        
        .logo-container { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-container img { height: 40px; width: auto; }
        .logo-text { font-size: 1.4rem; font-weight: 700; color: var(--primary-dark); font-family: 'Playfair Display', serif; }

        .header-actions .signin-btn {
            text-decoration: none; color: var(--primary-dark); font-weight: 600;
            padding: 10px 24px; background: rgba(0,0,0,0.03); border-radius: 50px;
            transition: var(--transition); font-size: 0.9rem; display: flex; align-items: center; gap: 8px;
        }
        .header-actions .signin-btn:hover { background: var(--primary-dark); color: #fff; transform: translateY(-2px); }

        /* ---- CONTACT SECTION ---- */
        .contact-wrapper {
            flex: 1; display: flex; align-items: center; justify-content: center;
            padding: 120px 20px 80px;
        }

        .contact-card {
            background: var(--surface-white); width: 100%; max-width: 900px;
            border-radius: var(--radius-lg); box-shadow: var(--shadow-elevated);
            display: grid; grid-template-columns: 1fr 1.2fr; overflow: hidden;
            animation: slideUp 0.6s ease-out; border: 1px solid rgba(0,0,0,0.04);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Left Side: Info */
        .contact-info {
            background: var(--primary-dark); color: #fff; padding: 40px;
            display: flex; flex-direction: column; justify-content: space-between;
            position: relative; overflow: hidden;
        }
        
        .contact-info::before {
            content: ''; position: absolute; top: -50px; right: -50px;
            width: 150px; height: 150px; background: var(--accent-main);
            border-radius: 50%; opacity: 0.2;
        }

        .info-header h1 { font-family: 'Playfair Display', serif; font-size: 2.2rem; margin-bottom: 15px; }
        .info-header p { opacity: 0.8; font-weight: 300; line-height: 1.6; }

        .info-details { margin-top: 40px; }
        .info-item { display: flex; align-items: flex-start; gap: 15px; margin-bottom: 25px; }
        
        .info-icon { 
            width: 45px; height: 45px; 
            background: rgba(255,255,255,0.1); 
            border-radius: 12px; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 1.2rem; 
            flex-shrink: 0;
            backdrop-filter: blur(5px);
        }

        .info-content h4 { font-size: 0.95rem; margin-bottom: 5px; opacity: 1; font-weight: 700; }
        .info-content p, .info-content a { font-size: 0.9rem; opacity: 0.8; font-weight: 400; color: #fff; text-decoration: none; }
        .info-content a:hover { text-decoration: underline; }

        /* Skeleton Loader Styles */
        .skeleton {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            animation: pulse 1.5s infinite;
        }
        .skeleton-text { height: 1em; width: 150px; display: inline-block; }
        .skeleton-text.short { width: 100px; }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.6; } 100% { opacity: 0.3; } }


        /* Right Side: Form */
        .contact-form-container { padding: 50px 40px; }
        
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-dark); font-size: 0.9rem; }
        
        .form-input, .form-textarea {
            width: 100%; padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px;
            font-family: inherit; font-size: 1rem; transition: var(--transition); background: #f8fafc;
        }
        .form-textarea { min-height: 120px; resize: vertical; }
        .form-input:focus, .form-textarea:focus {
            outline: none; border-color: var(--accent-main); background: #fff;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
        }

        .submit-btn {
            width: 100%; padding: 16px; background: var(--primary-dark); color: #fff;
            border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer;
            transition: var(--transition); display: flex; justify-content: center; align-items: center; gap: 10px;
        }
        .submit-btn:hover { background: #000; transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .submit-btn:disabled { opacity: 0.7; cursor: not-allowed; }

        /* Success/Error Message */
        #statusMessage {
            margin-top: 20px; padding: 15px; border-radius: 12px;
            font-size: 0.9rem; display: none; text-align: center;
        }
        .success { background: #ecfdf5; color: var(--success-green); border: 1px solid #d1fae5; }
        .error { background: #fef2f2; color: #ef4444; border: 1px solid #fee2e2; }

        /* Loading Spinner */
        .spinner {
            width: 20px; height: 20px; border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid #fff; border-radius: 50%;
            animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ---- FOOTER ---- */
        .main-footer { background: var(--primary-dark); color: #fff; padding: 80px 20px 140px 20px; position: relative; overflow: hidden; }
        .footer-content { max-width: 1200px; margin: 0 auto; text-align: center; position: relative; z-index: 2; }
        .footer-logo { font-size: 2rem; font-family: 'Playfair Display', serif; font-weight: 700; margin-bottom: 20px; display: inline-block; }
        .footer-text { color: #94a3b8; max-width: 500px; margin: 0 auto 40px; line-height: 1.6; }
        
        .footer-links { margin: 30px 0; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .footer-links a { color: #cbd5e1; text-decoration: none; font-size: 0.95rem; font-weight: 500; transition: 0.3s; opacity: 0.8; }
        .footer-links a:hover { color: #fff; opacity: 1; transform: translateY(-2px); }
        
        .social-icons { display: flex; justify-content: center; gap: 20px; margin-bottom: 40px; }
        .social-btn {
            width: 45px; height: 45px; border-radius: 50%;
            background: rgba(255, 255, 255, 0.05); color: #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1); text-decoration: none;
        }
        .social-btn:hover { background: var(--accent-main); transform: translateY(-5px); border-color: var(--accent-main); }

        .footer-copy { 
            border-top: 1px solid rgba(255,255,255,0.1); padding-top: 30px; 
            color: #64748b; font-size: 0.85rem; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 15px; max-width: 800px; margin: 0 auto;
        }
        .footer-copy a { color: #64748b; text-decoration: none; transition: 0.3s; }
        .footer-copy a:hover { color: #fff; }

        /* ---- SCROLL TO TOP BUTTON ---- */
        .scroll-top-btn {
            position: fixed; bottom: 40px; right: 20px; width: 50px; height: 50px;
            background: var(--glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.5); color: var(--primary-dark);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            opacity: 0; pointer-events: none; transform: translateY(20px); transition: var(--transition); z-index: 999;
        }
        .scroll-top-btn.visible { opacity: 1; pointer-events: all; transform: translateY(0); }
        .scroll-top-btn:hover { background: var(--primary-dark); color: #fff; transform: translateY(-5px); }

        @media (max-width: 768px) {
            .contact-card { grid-template-columns: 1fr; border-radius: 0; max-width: 100%; box-shadow: none; border: none; }
            .contact-wrapper { padding: 80px 0 0; }
            .contact-info { padding: 30px 20px; border-radius: 0 0 20px 20px; }
            .contact-form-container { padding: 30px 20px; }
            .footer-copy { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body id="top">

    <!-- HEADER -->
    <header id="header">
        <a href="index.html" class="logo-container">
            <img src="assets/images/logo.png" alt="Logo" id="headerLogo">
            <span class="logo-text" id="headerAppName">HireSphere</span>
        </a>
        <div class="header-actions">
            <a href="signin.html" class="signin-btn">
                <i class="fas fa-user-circle"></i> <span>Login</span>
            </a>
        </div>
    </header>

    <!-- CONTACT SECTION -->
    <div class="contact-wrapper">
        <div class="contact-card">
            
            <!-- Left: Info -->
            <div class="contact-info">
                <div class="info-header">
                    <h1>Get in Touch</h1>
                    <p>Have questions about your application, membership, or account verification? Our team is here to help.</p>
                </div>

                <div class="info-details">
                    <!-- EMAIL -->
                    <div class="info-item">
                        <div class="info-icon"><i class="fas fa-envelope"></i></div>
                        <div class="info-content">
                            <h4>Email Support</h4>
                            <p id="adminEmail"><span class="skeleton skeleton-text"></span></p>
                        </div>
                    </div>
                    <!-- PHONE -->
                    <div class="info-item">
                        <div class="info-icon"><i class="fas fa-phone-alt"></i></div>
                        <div class="info-content">
                            <h4>Call / WhatsApp</h4>
                            <p id="adminPhone"><span class="skeleton skeleton-text"></span></p>
                        </div>
                    </div>
                    <!-- ADDRESS -->
                    <div class="info-item">
                        <div class="info-icon"><i class="fas fa-map-marker-alt"></i></div>
                        <div class="info-content">
                            <h4>Headquarters</h4>
                            <p id="adminAddress"><span class="skeleton skeleton-text short"></span></p>
                        </div>
                    </div>
                </div>

                <div style="font-size: 0.8rem; opacity: 0.5; margin-top: 20px;">
                    Support ID: <span id="sessionID">HS-GEN</span>
                </div>
            </div>

            <!-- Right: Form -->
            <div class="contact-form-container">
                <form id="contactForm">
                    <div class="form-group">
                        <label class="form-label">Your Name</label>
                        <input type="text" id="name" class="form-input" placeholder="e.g. John Doe" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email Address</label>
                        <input type="email" id="email" class="form-input" placeholder="name@example.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <select id="subject" class="form-input">
                            <option value="General Inquiry">General Inquiry</option>
                            <option value="Membership Issue">Membership Issue</option>
                            <option value="Job Application">Job Application Query</option>
                            <option value="Technical Support">Technical Support</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <textarea id="message" class="form-textarea" placeholder="How can we assist you today?" required></textarea>
                    </div>

                    <button type="submit" id="submitBtn" class="submit-btn">
                        <div class="spinner" id="spinner"></div>
                        <span id="btnText">Send Message</span>
                    </button>

                    <div id="statusMessage"></div>
                </form>
            </div>

        </div>
    </div>

    <!-- FOOTER -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-logo" id="footerLogoText">HireSphere</div>
            <p class="footer-text">
                We are a premium career management agency. We do not sell jobs; fees cover membership, verification services, and exclusive platform access.
            </p>

            <div class="social-icons" id="footerSocials">
                <!-- Social Skeletons will be replaced by JS -->
                <a class="social-btn"><span class="skeleton" style="width:20px; height:20px; border-radius:50%"></span></a>
                <a class="social-btn"><span class="skeleton" style="width:20px; height:20px; border-radius:50%"></span></a>
            </div>

            <div class="footer-links">
                <a href="index.html">Home</a>
                <a href="jobs.html">Jobs Portal</a>
                <a href="dashboard.html">Member Dashboard</a>
                <a href="contact.html">Contact Us</a>
                <a href="privacy.html">Privacy Policy</a>
            </div>

            <div class="footer-copy">
                <span>&copy; <span id="year">2026</span> <span id="copyAppName">Hiresphere</span>. All Rights Reserved.</span>
                <span>
                    <a href="terms.html">Terms of Service</a> &bull; 
                    <a href="privacy.html">Privacy Policy</a> &bull;
                    <a href="#">Cookie Policy</a>
                </span>
            </div>
        </div>
    </footer>

    <!-- SCROLL TO TOP BUTTON -->
    <a href="#top" class="scroll-top-btn" id="scrollTopBtn" aria-label="Scroll to top">
        <i class="fas fa-chevron-up"></i>
    </a>

    <!-- FIREBASE & LOGIC -->
    <script type="module">
        import { db, auth } from './config.js'; 
        import { doc, getDoc, collection, addDoc, serverTimestamp, onSnapshot } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js';

        // UI Elements
        const headerAppName = document.getElementById('headerAppName');
        const footerLogoText = document.getElementById('footerLogoText');
        const copyAppName = document.getElementById('copyAppName');
        
        const adminEmailEl = document.getElementById('adminEmail');
        const adminPhoneEl = document.getElementById('adminPhone');
        const adminAddressEl = document.getElementById('adminAddress');
        const footerSocials = document.getElementById('footerSocials');
        const yearSpan = document.getElementById('year');

        const contactForm = document.getElementById('contactForm');
        const submitBtn = document.getElementById('submitBtn');
        const spinner = document.getElementById('spinner');
        const btnText = document.getElementById('btnText');
        const statusMessage = document.getElementById('statusMessage');

        // Set Year
        yearSpan.textContent = new Date().getFullYear();

        // 1. CONFIG LOADER (Sync with Master Admin)
        async function loadAppConfig() {
            console.log("Loading App Config...");
            try {
                // A. Branding
                const brandSnap = await getDoc(doc(db, "settings", "branding"));
                if (brandSnap.exists()) {
                    const data = brandSnap.data();
                    const appName = data.appName || 'HireSphere';
                    
                    document.title = `Contact Support | ${appName}`;
                    headerAppName.textContent = appName;
                    footerLogoText.textContent = appName;
                    copyAppName.textContent = appName;

                    if(data.primaryColor) document.documentElement.style.setProperty('--primary-dark', data.primaryColor);
                    if(data.fontFamily) document.documentElement.style.setProperty('--font-main', `${data.fontFamily}, sans-serif`);
                }

                // B. Contacts & Socials (Using onSnapshot for instant updates)
                const contactRef = doc(db, "settings", "contacts");
                onSnapshot(contactRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        
                        // Populate Text Fields (Remove skeletons)
                        adminAddressEl.textContent = data.address || "Nairobi, Kenya";
                        
                        // Email (Clickable)
                        if(data.email) {
                            adminEmailEl.innerHTML = `<a href="mailto:${data.email}">${data.email}</a>`;
                        } else {
                            adminEmailEl.textContent = "support@hiresphere.co.ke";
                        }

                        // Phone (Clickable)
                        if(data.phone) {
                            // Clean phone for href
                            const rawPhone = data.phone.replace(/\s+/g, '');
                            adminPhoneEl.innerHTML = `<a href="tel:${rawPhone}">${data.phone}</a>`;
                        } else {
                            adminPhoneEl.textContent = "+254 700 000 000";
                        }

                        // Generate Social Icons
                        let socialHtml = '';
                        if(data.whatsapp) socialHtml += `<a href="https://wa.me/${data.whatsapp.replace(/\D/g,'')}" class="social-btn" target="_blank"><i class="fab fa-whatsapp"></i></a>`;
                        if(data.tiktok) socialHtml += `<a href="${data.tiktok}" class="social-btn" target="_blank"><i class="fab fa-tiktok"></i></a>`;
                        if(data.facebook) socialHtml += `<a href="${data.facebook}" class="social-btn" target="_blank"><i class="fab fa-facebook-f"></i></a>`;
                        if(data.instagram) socialHtml += `<a href="${data.instagram}" class="social-btn" target="_blank"><i class="fab fa-instagram"></i></a>`;
                        if(data.email) socialHtml += `<a href="mailto:${data.email}" class="social-btn"><i class="fas fa-envelope"></i></a>`;
                        
                        // Fallback if no socials
                        if(socialHtml === '') socialHtml = '<span style="opacity:0.6; font-size:0.9rem">Follow us on social media</span>';
                        
                        footerSocials.innerHTML = socialHtml;
                    } else {
                        // Fallback if document doesn't exist
                        adminEmailEl.textContent = "support@hiresphere.co.ke";
                        adminPhoneEl.textContent = "+254 700 000 000";
                        adminAddressEl.textContent = "Nairobi, Kenya";
                        footerSocials.innerHTML = '';
                    }
                });

            } catch (e) { 
                console.error("Config Error", e);
                // Remove skeletons on error
                adminEmailEl.textContent = "support@hiresphere.co.ke";
                adminPhoneEl.textContent = "+254 700 000 000";
            }
        }

        // Init Config
        document.addEventListener('DOMContentLoaded', loadAppConfig);

        // 2. Prefill Form if User Logged In
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('email').value = user.email;
                if(user.displayName) document.getElementById('name').value = user.displayName;
                
                // Update Login Button
                const signinBtn = document.querySelector('.signin-btn');
                if(signinBtn) {
                    signinBtn.href = "dashboard.html";
                    signinBtn.innerHTML = '<i class="fas fa-user-check"></i><span>Dashboard</span>';
                }
            }
        });

        // 3. Handle Form Submission
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // UI Loading
            submitBtn.disabled = true;
            spinner.style.display = 'block';
            btnText.textContent = "Sending...";
            statusMessage.style.display = 'none';

            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const subject = document.getElementById('subject').value;
            const message = document.getElementById('message').value;

            try {
                // Generate a Ticket Code (Random 6 chars)
                const ticketCode = 'T-' + Math.random().toString(36).substr(2, 6).toUpperCase();
                
                // 1. Create Ticket Document
                const ticketRef = await addDoc(collection(db, "support_tickets"), {
                    ticketCode: ticketCode,
                    userName: name,
                    userEmail: email,
                    subject: subject,
                    status: 'open',
                    createdAt: serverTimestamp(),
                    lastUpdated: serverTimestamp(),
                    hasUnreadAdmin: true, // Flag for Admin Panel
                    userId: auth.currentUser ? auth.currentUser.uid : 'guest'
                });

                // 2. Add First Message to Subcollection
                await addDoc(collection(db, `support_tickets/${ticketRef.id}/messages`), {
                    text: message,
                    sender: 'user',
                    createdAt: serverTimestamp()
                });

                // Success UI
                statusMessage.className = 'success';
                statusMessage.innerHTML = `<i class="fas fa-check-circle"></i> Message sent! Your Ticket ID is <b>${ticketCode}</b>. We will contact you shortly.`;
                statusMessage.style.display = 'block';
                
                // Reset Form
                contactForm.reset();
                if(auth.currentUser) document.getElementById('email').value = auth.currentUser.email;

            } catch (error) {
                console.error("Submission error:", error);
                statusMessage.className = 'error';
                statusMessage.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Failed to send message. Please try again or use WhatsApp.';
                statusMessage.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                spinner.style.display = 'none';
                btnText.textContent = "Send Message";
            }
        });

        // Scroll Logic
        const header = document.getElementById('header');
        const scrollTopBtn = document.getElementById('scrollTopBtn');
        let lastScroll = 0;

        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;
            if (currentScroll <= 0) {
                header.classList.remove('hidden');
            } else {
                if (currentScroll > lastScroll && currentScroll > 100) {
                    header.classList.add('hidden');
                } else {
                    header.classList.remove('hidden');
                }
            }
            if (currentScroll > 300) scrollTopBtn.classList.add('visible');
            else scrollTopBtn.classList.remove('visible');
            lastScroll = currentScroll;
        });

        scrollTopBtn.addEventListener('click', (e) => {
            e.preventDefault();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>
</body>
</html>
